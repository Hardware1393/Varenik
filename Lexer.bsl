// ==========================================
// Varenik Engine v1.0 - Core Lexer Component
// Специализация: Гибрид BSL/Java + Puppy Linux Utils
// ==========================================

Перем СловарьСинтаксиса;

Процедура ИнициализироватьVarenikCore() Экспорт
    СловарьСинтаксиса = Новый Соответствие;
    
    // --- СЕКЦИЯ: МНОГОЯЗЫЧНЫЕ ОПЕРАТОРЫ ---
    
    // Определение функций/процедур
    РегистрироватьКоманду("Процедура,void,procedimiento,إجراء", "FUNC_START");
    РегистрироватьКоманду("КонецПроцедуры,end,fin,نهاية", "FUNC_END");
    
    // Переменные
    РегистрироватьКоманду("Перем,String,variable,متغير", "VAR_DECL");
    
    // Попытка-Исключение (Java/BSL Try-Catch)
    РегистрироватьКоманду("Попытка,try,intentar,محاولة", "TRY");
    РегистрироватьКоманду("Исключение,catch,excepción,استثناء", "CATCH");
    
    // --- СЕКЦИЯ: 60 СИСТЕМНЫХ ФУНКЦИЙ (PUPPY LINUX STYLE) ---
    
    // Вывод информации
    РегистрироватьКоманду("Сообщить,System.out.println,informar,أبلغ", "LOG_PRINT");
    
    // Фишка: Прямое управление "железом" (Puppy RAM-mode)
    РегистрироватьКоманду("Varenik.FlushRAM,ОчиститьПамять", "SYS_FREE_MEM");
    РегистрироватьКоманду("Varenik.GetPuppyStatus,СтатусСистемы", "SYS_INFO");
    
    // Фишка: Работа с расширением .bexe
    РегистрироватьКоманду("Varenik.ExecuteBinary,ВыполнитьБинарник", "EXEC_BEXE");
    
    // Фишка: Сверхбыстрое монтирование (SFS-стиль)
    РегистрироватьКоманду("MountModule,ПодключитьМодуль", "SYS_MOUNT");

КонецПроцедуры

// Служебная функция для массовой регистрации синонимов
// Параметры:
//   СписокСинонимов - Строка - Синонимы команды разделенные запятыми
//   ВнутреннийID - Строка - Внутренний идентификатор команды
Процедура РегистрироватьКоманду(СписокСинонимов, ВнутреннийID)
    МассивСлов = СтрРазделить(СписокСинонимов, ",");
    Для Каждого Слово Из МассивСлов Цикл
        СловарьСинтаксиса.Вставить(СокрЛП(Слово), ВнутреннийID);
    КонецЦикла;
КонецПроцедуры

Функция Токенизировать(ТекстКода) Экспорт
    ИнициализироватьVarenikCore();
    Результат = Новый Массив;
    
    // Очистка комментариев и разбивка на строки
    Строки = СтрРазделить(ТекстКода, Символы.ПС);
    
    Для Каждого Стр Из Строки Цикл
        // Убираем комментарии //
        ПозКомм = СтрНайти(Стр, "//");
        ЧистаяСтрока = ?(ПозКомм > 0, Лев(Стр, ПозКомм - 1), Стр);
        ЧистаяСтрока = СокрЛП(ЧистаяСтрока);
        
        Если ПустаяСтрока(ЧистаяСтрока) Тогда Продолжить; КонецЕсли;

        // ВАЖНО: Разбиваем с учетом спецсимволов Java (точки, скобки, кавычки)
        МассивТокенов = РазбитьНаТокены(ЧистаяСтрока);
        
        Для Каждого Слово Из МассивТокенов Цикл
            Тип = СловарьСинтаксиса.Получить(Слово);
            Если Тип = Неопределено Тогда
                Тип = "IDENTIFIER"; // Имя переменной или значение
            КонецЕсли;
            Результат.Добавить(Новый Структура("Type, Value", Тип, Слово));
        КонецЦикла;
    КонецЦикла;
    
    Возврат Результат;
КонецФункции

// Puppy Linux Style: Легковесный парсер строки без тяжелых объектов
// Параметры:
//   Стр - Строка - Строка для разбиения на токены
// Возвращаемое значение:
//   Массив - Массив токенов
Функция РазбитьНаТокены(Знач Стр)
    ОбработаннаяСтрока = СтрЗаменить(Стр, "(", " ( ");
    ОбработаннаяСтрока = СтрЗаменить(ОбработаннаяСтрока, ")", " ) ");
    ОбработаннаяСтрока = СтрЗаменить(ОбработаннаяСтрока, ";", " ; ");
    ОбработаннаяСтрока = СтрЗаменить(ОбработаннаяСтрока, "=", " = ");
    Возврат СтрРазделить(ОбработаннаяСтрока, " ", Ложь);
КонецФункции